{% extends 'master.html' %}
{% block content%}
{% include 'components/header.html'%}

<body>
    <div class="h-screen bg-gray-100 pt-20">
        <h1 class="mb-10 text-center text-2xl font-bold">Winkelwagen </h1>
        {% if cart_items %}
        <div class="mx-auto max-w-5xl justify-center px-6 md:flex md:space-x-6 xl:px-0">
            <div class="rounded-lg md:w-2/3">
                {% for item in cart_items %}
                    <div class="justify-between mb-6 rounded-lg bg-white p-6 shadow-md sm:flex sm:justify-start">
                        <img class="rounded-t-lg p-8 h-64 w-full object-contain" src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                        <div class="sm:ml-4 sm:flex sm:w-full sm:justify-between">
                            <div class="mt-5 sm:mt-0">
                                <h2 class="text-lg font-bold text-gray-900">{{ item.product.name }}</h2>
                                <p class="mt-1 text-xs text-gray-700">{{ item.product.description|truncatewords:5 }}</p>
                            </div>
                            <div class="mt-4 flex justify-between sm:space-y-6 sm:mt-0 sm:block sm:space-x-6">
                                <div class="flex items-center border-gray-100">
                                    <span class="cursor-pointer rounded-l bg-gray-100 py-1 px-3.5 duration-100 hover:bg-blue-500 hover:text-blue-50"> - </span>
                                    <input class="h-8 w-8 border bg-white text-center text-xs outline-none" type="number" value="{{ item.quantity }}" min="1" />
                                    <span class="cursor-pointer rounded-r bg-gray-100 py-1 px-3 duration-100 hover:bg-blue-500 hover:text-blue-50"> + </span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <p class="text-sm">€{{ item.product.price }}</p>
                                </div>
                            </div>
                            <div class="mt-52">
                                <button type="button" data-product-id="{{ item.product.id }}" class="remove-item focus:outline-none text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-900">Verwijderen</button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <div class="mt-6 h-full rounded-lg border bg-white p-6 shadow-md md:mt-0 md:w-1/3">
                <div class="mb-2 flex justify-between">
                    <p class="text-gray-700">Subtotaal</p>
                    <p class="text-gray-700">€{{ total_price }}</p>
                </div>
                <div class="flex justify-between">
                    <p class="text-gray-700">Verzenden</p>
                    <p class="text-gray-700">Gratis</p>
                </div>
                <hr class="my-4" />
                <div class="flex justify-between">
                    <p class="text-lg font-bold">Totaal</p>
                    <div class="">
                        <p class="mb-1 text-lg font-bold">€{{ total_price }}</p>
                        <p class="text-sm text-gray-700">Inclusief BTW</p>
                    </div>
                </div>
                <button class="mt-6 w-full rounded-md bg-blue-500 py-1.5 font-medium text-blue-50 hover:bg-blue-600">Bestellen</button>
            </div>
        </div>
        {% endif %}
    </div>
</body>

{% include 'components/footer.html' %}

<script>
    document.querySelectorAll('.remove-item').forEach(button => {
        button.addEventListener('click', function(e) {
            const productId = this.dataset.productId;

            fetch('/remove-from-cart/', {
                method: 'POST',
                body: JSON.stringify({
                    product_id: productId
                }),
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(response => response.json())
            .then(data => {
                if(data.status === 'success') {
                    location.reload();
                } else {
                    alert('Er ging iets mis bij het verwijderen van het product.');
                }
            })
        });
    });
</script>
{% endblock %}
